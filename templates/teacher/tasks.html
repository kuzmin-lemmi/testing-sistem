{% extends "teacher/base.html" %}

{% block title %}–ë–∞–Ω–∫ –∑–∞–¥–∞—á - –ï–ì–≠ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞{% endblock %}

{% block content %}
<div class="tasks-page">
    <div class="page-header">
        <h1>üìù –ë–∞–Ω–∫ –∑–∞–¥–∞—á</h1>
        <div class="header-actions">
            <a href="{{ url_for('tasks_import') }}" class="btn btn-outline">üì• –ò–º–ø–æ—Ä—Ç</a>
            <a href="{{ url_for('tasks_export') }}" class="btn btn-outline">üì§ –≠–∫—Å–ø–æ—Ä—Ç</a>
            <a href="{{ url_for('tasks_bulk_upload', ege=selected_ege or 1) }}" class="btn btn-secondary">üì¶ –ú–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞</a>
            <a href="{{ url_for('task_add', ege=selected_ege or 1) }}" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</a>
        </div>
    </div>
    
    <div class="tasks-layout">
        <aside class="ege-sidebar">
            <h3>–ù–æ–º–µ—Ä–∞ –ï–ì–≠</h3>
            <ul class="ege-list">
                {% for num in range(1, 28) %}
                <li>
                    <a href="{{ url_for('tasks_list', ege=num) }}" 
                       class="{% if selected_ege == num %}active{% endif %} {% if task_counts.get(num, 0) == 0 %}empty{% endif %}">
                        <span class="num">‚Ññ{{ num }}</span>
                        <span class="count">{{ task_counts.get(num, 0) }}</span>
                        <span class="answers-hint">
                            {% if default_answer_count.get(num, 1) == 2 %}(2 –æ—Ç–≤.){% endif %}
                        </span>
                    </a>
                </li>
                {% endfor %}
            </ul>
        </aside>
        
        <div class="tasks-content">
            {% if selected_ege %}
                <div class="tasks-header">
                    <h2>–ó–∞–¥–∞–Ω–∏—è ‚Ññ{{ selected_ege }}</h2>
                    <span class="task-info">
                        –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: {{ default_answer_count.get(selected_ege, 1) }} –æ—Ç–≤–µ—Ç(–∞)
                    </span>
                </div>
                
                {% if tasks %}
                    <div class="tasks-grid">
                        {% for task in tasks %}
                        <div class="task-card">
                            <div class="task-image">
                                <img src="{{ url_for('serve_image', filename=task.image_path) }}" alt="–ó–∞–¥–∞—á–∞ {{ task.id }}">
                            </div>
                            <div class="task-info">
                                <div class="task-id">#{{ task.id }}</div>
                                <div class="task-answer">
                                    {% if task.answer_text %}
                                    –û—Ç–≤–µ—Ç: <span class="special-answer">–æ—Å–æ–±—ã–π —Ñ–æ—Ä–º–∞—Ç</span>
                                    {% else %}
                                    –û—Ç–≤–µ—Ç: {{ task.answer_1 }}{% if task.answer_count == 2 %}, {{ task.answer_2 }}{% endif %}
                                    {% endif %}
                                </div>
                                {% if task.attachment_path %}
                                <div class="task-attachment">
                                    üìé {{ task.attachment_name }}
                                </div>
                                {% endif %}
                            </div>
                            <div class="task-actions">
                                <a href="{{ url_for('task_view', task_id=task.id) }}" class="btn btn-small">üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                                <a href="{{ url_for('task_edit', task_id=task.id) }}" class="btn btn-small">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                                <form action="{{ url_for('task_delete', task_id=task.id) }}" method="POST" class="inline-form" 
                                      onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É #{{ task.id }}?')">
                                    <button type="submit" class="btn btn-small btn-danger">üóë</button>
                                </form>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <p>–ó–∞–¥–∞—á–∏ –¥–ª—è –Ω–æ–º–µ—Ä–∞ {{ selected_ege }} –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
                        <a href="{{ url_for('task_add', ege=selected_ege) }}" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É</a>
                    </div>
                {% endif %}
            {% else %}
                <div class="empty-state">
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–º–µ—Ä –ï–ì–≠ —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–¥–∞—á–∏</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
